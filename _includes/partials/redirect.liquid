{%- for lang in site.supportedLanguages -%}
  {% assign URL = "/" | append: lang | append: permalink %}
  {%- if forloop.first -%}
    <if cookie="{{ 'lastLang is ' | append: lang }}">
      <redirect to="{{ URL | htmlBaseUrl }}" type="permanent" />
    </if>
  {%- else -%}
    <elseif cookie="{{ 'lastLang is ' | append: lang }}">
      <redirect to="{{ URL | htmlBaseUrl }}" type="permanent" />
    </elseif>
  {%- endif -%}
{%- endfor -%}

{%- for lang in site.supportedLanguages -%}
  {% assign URL = "/" | append: lang | append: permalink %}
  <elseif variable="{{ 'client.accept-language is ' | append: lang }}">
    <redirect to="{{ URL | htmlBaseUrl }}" type="permanent" />
  </elseif>
{%- endfor -%}

{% assign defaultURL = "/en" | append: permalink | htmlBaseUrl %}
<else>
  <redirect to="{{ defaultURL }}" type="permanent" />
</else>